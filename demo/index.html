<!DOCTYPE html>
<html lang="en">
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<!-- Meta, title, CSS, favicons, etc. -->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		

		<!-- ****** faviconit.com favicons ****** -->
		<link rel="shortcut icon" href="static/favicon/favicon.ico">
		<link rel="icon" sizes="16x16 32x32 64x64" href="static/favicon/favicon.ico">
		<link rel="icon" type="image/png" sizes="196x196" href="static/favicon/favicon-192.png">
		<link rel="icon" type="image/png" sizes="160x160" href="static/favicon/favicon-160.png">
		<link rel="icon" type="image/png" sizes="96x96" href="static/favicon/favicon-96.png">
		<link rel="icon" type="image/png" sizes="64x64" href="static/favicon/favicon-64.png">
		<link rel="icon" type="image/png" sizes="32x32" href="static/favicon/favicon-32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="static/favicon/favicon-16.png">
		<link rel="apple-touch-icon" href="static/favicon/favicon-57.png">
		<link rel="apple-touch-icon" sizes="114x114" href="static/favicon/favicon-114.png">
		<link rel="apple-touch-icon" sizes="72x72" href="static/favicon/favicon-72.png">
		<link rel="apple-touch-icon" sizes="144x144" href="static/favicon/favicon-144.png">
		<link rel="apple-touch-icon" sizes="60x60" href="static/favicon/favicon-60.png">
		<link rel="apple-touch-icon" sizes="120x120" href="static/favicon/favicon-120.png">
		<link rel="apple-touch-icon" sizes="76x76" href="static/favicon/favicon-76.png">
		<link rel="apple-touch-icon" sizes="152x152" href="static/favicon/favicon-152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="static/favicon/favicon-180.png">
		<meta name="msapplication-TileColor" content="#FFFFFF">
		<meta name="msapplication-TileImage" content="static/favicon/favicon-144.png">
		<meta name="msapplication-config" content="static/browserconfig.xml">
		<!-- ****** faviconit.com favicons ****** -->

		<title>Dashboard |  My Students </title>

		<!-- Bootstrap -->
		<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
		<!-- Font Awesome -->
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
		<!-- bootstrap-progressbar -->
		<!-- <link href="static/vendors/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet"> -->
	

		<!-- Custom Theme Style -->
		<link href="static/css/custom.css" rel="stylesheet">
	
</head>

<body class="nav-md ">

	<div class="container body">
		<div class="main_container">

			
	<div
		class="col-md-3 left_col  "
		style="height: 100vh;">
		<div class="left_col scroll-view">

	<div class="navbar nav_title" style="border: 0;">
		<a href="/" class="site_title">
			<img src="static/images/branding/ub-shield-white.png"
				 style="height: 46px; margin: 0 10px">
			<span><img src="static/images/branding/ub-text-white.png" height="34"></span>
		</a>
	</div>

	<div class="clearfix"></div>

	<!-- menu profile quick info -->
	<div class="profile clearfix">
		<div class="profile_pic">
			<img src="https://www.gravatar.com/avatar/a0ba33da55c23560097f507b99ea9d7a?d=http%3A%2F%2Fcarrotpiracy.com%3A8000%2Fimg%2Fuser.jpeg" alt="lauraigual@gmail.com"
				 class="img-circle profile_img">
		</div>
		<div class="profile_info">
			<span>Welcome,</span>
			<h2>Laura Igual</h2>
		</div>
	</div>
	<!-- /menu profile quick info -->

	<br/>

	<!-- sidebar menu -->
	<div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
		<div class="menu_section">
			<!--<h3>General</h3>-->

			<ul class="nav side-menu">

				<li><a><i class="fa fa-home"></i> Home <span class="fa fa-chevron-down"></span></a>
					<ul class="nav child_menu">
						<li><a href="/">Home Page</a></li>
						<li><a href="/faculties/1">Dept. of Mathematics</a></li>
						<li><a href="/faculties/2">Dept. of Comp.Sci.</a></li>
					</ul>
				</li>


				<li><a><i class="fa fa-user"></i> Profile <span class="fa fa-chevron-down"></span></a>
					<ul class="nav child_menu">
						<li><a href="/profile/">My Profile</a></li>
						<li><a href="/inbox/">My Inbox</a></li>
						<li><a href="#">Contact My Tutor</a></li>
						<li><a href="#">View my stats</a></li>
					</ul>
				</li>

				<li><a><i class="fa fa-newspaper-o"></i> News <span class="fa fa-chevron-down"></span></a>
					<ul class="nav child_menu">
						<li><a href="#">News</a></li>
						<li><a href="#">Events</a></li>
						<li><a href="#">Calendar</a></li>
						<li><a href="#">Forums</a></li>
					</ul>
				</li>

				<li><a><i class="fa fa-sitemap"></i> Site <span class="fa fa-chevron-down"></span></a>
					<ul class="nav child_menu">
						<li><a href="/about/">About Us</a></li>
					</ul>
				</li>


			</ul>
		</div>


	</div>
	<!-- /sidebar menu -->

	<!-- /menu footer buttons -->
	<div class="sidebar-footer hidden-small">
		<a data-toggle="tooltip" data-placement="top" title="Settings">
			<span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
		</a>
		<a data-toggle="tooltip" data-placement="top" title="FullScreen">
			<span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
		</a>
		<a data-toggle="tooltip" data-placement="top" title="Lock">
			<span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
		</a>
		<a data-toggle="tooltip" data-placement="top" title="Logout" href="/logout/">
			<span class="glyphicon glyphicon-off" aria-hidden="true"></span>
		</a>
	</div>
	<!-- /menu footer buttons -->
</div>

</div>
			
			
<div class="top_nav">
					
<div class="nav_menu">
	<nav>
		<div class="nav toggle">
			<a id="menu_toggle"><i class="fa fa-bars"></i></a>
		</div>

		<ul class="nav navbar-nav navbar-right" id="notification-app">

			<li class="">
				<a href="javascript:" class="user-profile dropdown-toggle" data-toggle="dropdown"
				   aria-expanded="false">
					<img src="https://www.gravatar.com/avatar/a0ba33da55c23560097f507b99ea9d7a?d=http%3A%2F%2Fcarrotpiracy.com%3A8000%2Fimg%2Fuser.jpeg" alt="">
					Laura Igual
					<span class=" fa fa-angle-down"></span>
				</a>
				<ul class="dropdown-menu dropdown-usermenu pull-right">
					<li><a href="/profile/">Profile</a></li>

					
					<li>
						<a href="/students/">
							<span class="badge pull-right bg-white">20</span>
							<span>My Students</span>
						</a>
					</li>
					<li>
							<a href="/degree/G10077">
								<span class="badge pull-right bg-white">455</span>
								<span>Degree Dashboard</span>
							</a>
						</li>
					<li>
						<a href="/settings/">Administration</a>
					</li>
					

					<li>
						<a href="/logout/"><i class="fa fa-sign-out pull-right"></i> Log Out</a>
					</li>
				</ul>
			</li>






		</ul>


	</nav>
</div>

</div>
			

<div class="right_col" role="main" style="height: calc(100vh - 58px); overflow:auto;">
				

	<div id="app">

		<div class="page-title">
			<h3>My Students |
				<small class="hidden-sm hidden-xs">View, manage and take actions on your mentored Students.</small>
			</h3>
		</div>

		<div class="clearfix"></div>

		<div class="row">

			<div id="top-students" class="col-md-6 col-sm-12">
				<div class="x_panel">
					<div class="x_title" style="
						background-color: #d6d61a;
						border-radius:  5px;
						color: white;
						border: 0;
						padding: 4px 12px;
						text-shadow: 1px 1px 1px gray">
						<h2>
							<i class="fa fa-star"></i> Top Students
							<small style="color:white">Ahead of the pack.</small>
						</h2>

						<div class="clearfix"></div>
					</div>

					<div class="x_content" style="height: 220px; overflow-x: hidden">
						<student-table :students="topStudents" :show-rank="true" :show-stats="false" :show-actions="false"></student-table>
					</div>
				</div>
			</div>

			<div id="dropout-students" class="col-md-6 col-sm-12">
				<div class="x_panel">
					<div class="x_title" style="
						background-color: #ff5757;
						border-radius:  5px;
						color: white;
						border: 0;
						padding: 4px 12px;
						text-shadow: 1px 1px 1px gray">
						<h2>
							<i class="fa fa-warning"></i> Projected Dropouts
							<small style="color:white">Predicted to dropout by next year.</small>
						</h2>

						<div class="clearfix"></div>
					</div>

					<div class="x_content" style="height:220px; overflow-y: auto; overflow-x: hidden">
						<student-table :students="dropoutStudents" :show-rank="true" :show-stats="false"></student-table>
					</div>

				</div>
			</div>

			<div id="mentored-students" class="col-xs-12">
				<div class="x_panel">
					<div class="x_title">
						<h2 style="width:auto">
							<i class="fa fa-user"></i> Mentored Students
							<small>List of students you mentor, grouped by their Degree.</small>
						</h2>
						<!-- Sort Icons -->
						<h2 style="width:auto" class="pull-right">

							<i @click="sortAbc" class="fa fa-sort-alpha-asc" style="cursor:pointer">&nbsp;</i>
							<i @click="sortAsc" class="fa fa-sort-amount-asc" style="cursor:pointer">&nbsp;</i>
							<i @click="sortDesc" class="fa fa-sort-amount-desc" style="cursor:pointer">&nbsp;</i>
						</h2>
						<div class="clearfix"></div>
					</div>

					<div class="x_content" style="min-height: 250px">

						<!-- TABBED STUDENT LIST -->
						<div role="tabpanel">

							<ul class="nav nav-tabs bar_tabs" role="tablist">

								<li v-for="(degree, i) in degrees" role="presentation" :class="{active:i==0}">
									<a :href="'#tab_'+degree.code" role="tab" data-toggle="tab" :aria-expanded="i==0">
										[[ degree.name ]]</a>
								</li>

							</ul>

							<div class="tab-content">

								<div v-for="(degree, i) in degrees" role="tabpanel" :id="'tab_'+degree.code" :class="{'tab-pane':true, fade:true, active:i==0, in:i==0}">

									<student-table :students="degreeStudents(degree.code)" :show-rank="true"></student-table>

								</div>

							</div>

						</div>
						<!-- END TABBED STUDENT LIST -->
					</div>
				</div>


			</div>

		</div>

	</div>



	<div class="row" style="margin-top: 20px">
		<div class="pull-right"> Espai Tutorial | <a href="https://ub.edu">Universitat de Barcelona</a> 2017-18</div>
		<div class="clearfix"></div>
	</div>

</div>

			
	<footer class="hidden-xs" style="display:none">
	<div class="pull-right"> Espai Tutorial | <a href="https://ub.edu">Universitat de Barcelona</a> 2017-18</div>
	<div class="clearfix"></div>
</footer>

			
		</div>
	</div>

	<!-- CDN JS -->
	<script src="https://unpkg.com/vue@2.5.13/dist/vue.js"></script>
	<script src="https://unpkg.com/vue-router@3.0.1/dist/vue-router.js"></script>

	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script> -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/locale/es.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/locale/ca.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/locale/en-gb.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-progressbar/0.9.0/bootstrap-progressbar.min.js"></script> -->

	<script src="static/js/custom.js"></script>

	<script>
		/* Config */
		axios.defaults.xsrfCookieName = 'csrftoken'
		axios.defaults.xsrfHeaderName = 'X-CSRFToken'

		window.chartColors = {
			green: 'rgba(65, 192, 160, 1)',
			yellow: 'rgba(255, 205, 86, 1)',
			red: 'rgba(255, 99, 132, 1)',
			purple: 'rgba(153, 102, 255, 1)',
			grey: 'rgba(201, 203, 207, 1)',
			orange: 'rgba(255, 159, 64, 1)',
			blue: 'rgba(54, 162, 235, 1)',
			trans: 'rgba(0,0,0,0)',
		};

		let locale = "en";
		moment.locale(locale);


		Vue.filter('fromNow', val => moment(val).fromNow())
		
		Vue.filter('cut', val => {
			val = val.replace(/<(?:.|\n)*?>/gm, '');
			if (val.length > 50)
				return val.slice(0,50)+"...";
			return val
		})
	</script>

	<script src="static/vue-components/student-table.js"></script>

	<script>

		vm = new Vue({
				el: '#app',
				delimiters: ['[[', ']]'],
				data: {
					students: [],
					degrees: []
				},

				computed: {
					topStudents(){
						let avg = s => ( s.recordSet.reduce( (a,r) => (a+r.meanGrade), 0) / s.recordSet.length );
						let sorted = this.students.slice(0).sort( (a,b) => {
							return avg(b) - avg(a)
						})
						return sorted.filter(s => {
							let percentile = s.recordSet.map(r => r.percentile).reduce( (a,b) => Math.min(a,b), 99 )
							return percentile <=10;
						})
					},

					dropoutStudents(){
						let avg = s => ( s.recordSet.reduce( (a,r) => (a+r.meanGrade), 0) / s.recordSet.length );
						let dropouts = this.students.slice(0).filter( s => {
							for (var i = 0, len = s.recordSet.length; i < len; i++){
								if( s.recordSet[i].predDropout ) return true
							}
							return false;
						})
						return dropouts.sort((a,b) => avg(a) - avg(b))
					}


				},

				methods: {
					degreeStudents(degreeCode){
						return this.students.filter(s => {
							for (var i = 0, len = s.recordSet.length; i < len; i++){
								if( s.recordSet[i].degree.code == degreeCode ) return true
							}
							return false;
						})
					},

					getBGClasses(grade) {
						let color = 'bg-green';
						if (grade < 7) color = 'bg-orange';
						if (grade < 5) color = 'bg-red';
						return `progress-bar ${color}`
					},

					growth(present, old) {
						let delta = present - old;
						return (delta / old * 100).toFixed(1);
					},

					sortAsc(){
						let avg = s => ( s.recordSet.reduce( (a,r) => (a+r.meanGrade), 0) / s.recordSet.length );
						this.students.sort((a,b) => avg(a) - avg(b))
					},

					sortDesc(){
						let avg = s => ( s.recordSet.reduce( (a,r) => (a+r.meanGrade), 0) / s.recordSet.length );
						this.students.sort((a,b) => avg(b) - avg(a))

					},

					sortAbc(){
						this.students.sort( (a,b) => a.profile.user.lastName.localeCompare(b.profile.user.lastName));
					},
				},

				mounted() {

					function unique(value, index, self) { return self.indexOf(value) === index; }

					axios.get('data/students.json').then(response => {
						this.students = response.data.data.students;
						// Sort by surname
						this.students.sort( (a,b) => a.profile.user.lastName.localeCompare(b.profile.user.lastName))

						this.degrees = response.data.data.degrees;
					})

				}
			})

	</script>

</body>
</html>
